---
import PrimaryCTA from '@components/ui/buttons/PrimaryCTA.astro'
import SecondaryCTA from '@components/ui/buttons/SecondaryCTA.astro'
import Image from '@components/ui/images/Image.astro'
import type { CollectionEntry } from 'astro:content'

const {
    title,
    subTitle,
    primaryBtn,
    primaryBtnURL,
    secondaryBtn,
    secondaryBtnURL,
    src,
    alt,
    latestPost,
} = Astro.props

interface Props {
    title: string
    subTitle?: string
    primaryBtn?: string
    primaryBtnURL?: string
    secondaryBtn?: string
    secondaryBtnURL?: string
    src?: any
    alt?: string
    latestPost?: CollectionEntry<'posts'>
}
---
<section class="mx-auto grid max-w-[85rem] gap-4 px-4 py-14 sm:px-6 md:grid-cols-5 md:items-center md:gap-8 lg:px-8 2xl:max-w-full">
    <!-- Columna de texto - ocupa 3 de 5 columnas en desktop, full width en móvil -->
    <div class="md:col-span-3 md:pl-8 lg:pl-12 xl:pl-16">
        <!-- Contenedor para centrar texto en móvil con mismo ancho que botones -->
        <div class="text-center md:text-left max-w-sm mx-auto md:max-w-none md:mx-0">
            <h1 class="block text-balance text-3xl font-bold tracking-tight text-neutral-800 dark:text-neutral-200 sm:text-4xl lg:text-6xl lg:leading-tight">
                <Fragment set:html={title} />
            </h1>
            {subTitle && (
                <p class="mt-6 text-pretty text-lg leading-relaxed text-neutral-700 dark:text-neutral-400 lg:w-full xl:w-4/5">
                    {subTitle}
                </p>
            )}
        </div>
        
        <div class="mt-7 flex flex-col gap-3 sm:flex-row sm:gap-4 max-w-sm mx-auto md:max-w-none md:mx-0">
            {primaryBtn ? (
                <PrimaryCTA title={primaryBtn} url={primaryBtnURL} />
            ) : (
                <PrimaryCTA title="JOIN" url="#" />
            )}
            
            {secondaryBtn ? (
                <SecondaryCTA title={secondaryBtn} url={secondaryBtnURL} />
            ) : (
                <SecondaryCTA title="explore posts" url="#" />
            )}
        </div>
    </div>
    
    <!-- Columna de post card vintage - VISIBLE EN MÓVIL -->
    <div class="md:col-span-2 w-full mt-8 md:mt-0">
        <div class="flex flex-col items-center space-y-4">
            <!-- Título de la sección con estilo WW2 -->
            <h3 class="latest-bite-title text-xl font-semibold text-center">
                This Week's Bite
            </h3>
            
            <!-- Post Card Vintage -->
            {latestPost && latestPost.data ? (
                <a 
                    href={`/posts/${latestPost.slug}/`}
                    class="latest-post-card block max-w-sm w-full transition-all duration-300"
                    data-astro-prefetch
                >
                    <!-- Overlay vintage -->
                    <div class="vintage-overlay"></div>
                    
                    <!-- Imagen del post -->
                    <div class="aspect-video overflow-hidden rounded-t-lg relative">
                        <Image
                            src={latestPost.data.banner}
                            alt={latestPost.data.title}
                            class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
                            draggable="false"
                            loading="eager"
                            format="avif"
                            width={400}
                            height={225}
                            inferSize={true}
                            disableBlur={true}
                        />
                    </div>
                    
                    <!-- Contenido del post -->
                    <div class="post-content p-4 relative z-10">
                        <!-- Meta información -->
                        <div class="post-meta flex items-center gap-3 mb-2">
                            {latestPost.data.category && (
                                <span class="category-tag text-xs">
                                    📁 {latestPost.data.category}
                                </span>
                            )}
                            {latestPost.data["reading-time"] && (
                                <span class="reading-time text-xs">
                                    ⏱️ {latestPost.data["reading-time"]}
                                </span>
                            )}
                        </div>
                        
                        <!-- Título del post -->
                        <h4 class="post-title font-bold text-lg line-clamp-2 leading-tight mb-2">
                            {latestPost.data.title}
                        </h4>
                        
                        <!-- Descripción del post -->
                        <p class="post-description text-sm line-clamp-2 mb-3">
                            {latestPost.data.description}
                        </p>
                        
                        <!-- Read more link -->
                        <div class="read-more-link inline-flex items-center text-xs font-medium cursor-pointer">
                            Read more
                            <svg class="w-3 h-3 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </div>
                    </div>
                </a>
            ) : (
                <!-- DEBUG: Mostrar información de depuración -->
                <div class="latest-post-card block max-w-sm w-full bg-red-100 border border-red-300 rounded-lg p-4">
                    <div class="text-red-800">
                        <h4 class="font-bold">DEBUG INFO:</h4>
                        <p>latestPost exists: {latestPost ? 'YES' : 'NO'}</p>
                        <p>latestPost type: {typeof latestPost}</p>
                        {latestPost && <p>Post title: {latestPost.data?.title || 'No title'}</p>}
                        {latestPost && <p>Post slug: {latestPost.slug || 'No slug'}</p>}
                        {latestPost && <p>Post data keys: {Object.keys(latestPost.data || {}).join(', ')}</p>}
                        <p class="mt-2 text-sm">Props received: {JSON.stringify(Object.keys(Astro.props))}</p>
                        <p class="text-sm">All props: {JSON.stringify(Astro.props, null, 2).substring(0, 200)}...</p>
                    </div>
                </div>
            )}
        </div>
    </div>
</section>

<style>
/* Título "This Week's Bite" con estilo WW2 - FORZAR ROJO */
.latest-bite-title,
h3.latest-bite-title {
    color: #b3413e !important; /* ROJO ABSOLUTO FORZADO */
    font-family: var(--ww2-font-sans, 'Oswald', sans-serif) !important;
    font-weight: 700 !important;
    text-transform: uppercase !important;
    letter-spacing: 1px !important;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.15) !important;
}

/* Sobrescribir cualquier clase de Tailwind */
.latest-bite-title.text-xl,
.latest-bite-title.font-semibold,
.latest-bite-title.text-neutral-800,
.latest-bite-title.text-neutral-200 {
    color: #b3413e !important; /* FORZAR ROJO SOBRE TAILWIND */
}

/* Card del latest post con estilo vintage */
.latest-post-card {
    position: relative;
    background-image: url('/src/images/paper-texture.webp');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    
    /* Borde rojo WW2 Bites */
    border: 3px solid #b3413e;
    border-radius: 12px;
    
    /* Sombras estilo papel antiguo */
    box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.15),
        0 2px 6px rgba(0, 0, 0, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    
    /* Transiciones suaves */
    transition: all 0.4s ease;
    
    /* Padding para el efecto de marco */
    padding: 6px;
    background-clip: padding-box;
    overflow: hidden;
}

/* Overlay sutil de textura vintage */
.vintage-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
        135deg,
        rgba(245, 245, 220, 0.3) 0%,
        rgba(250, 235, 215, 0.2) 25%,
        rgba(240, 230, 200, 0.3) 50%,
        rgba(245, 240, 220, 0.2) 75%,
        rgba(248, 243, 223, 0.3) 100%
    );
    border-radius: inherit;
    pointer-events: none;
    z-index: 1;
    mix-blend-mode: multiply;
}

/* Contenido sobre la textura */
.post-content {
    position: relative;
    z-index: 2;
}

/* Efecto hover vintage */
.latest-post-card:hover {
    transform: translateY(-4px) rotate(1deg);
    border-color: #8b2f2c; /* Borde rojo más oscuro en hover */
    box-shadow: 
        0 12px 24px rgba(0, 0, 0, 0.25),
        0 6px 12px rgba(0, 0, 0, 0.15),
        inset 0 2px 0 rgba(255, 255, 255, 0.15),
        0 0 0 1px rgba(179, 65, 62, 0.3); /* Glow sutil rojo */
}

/* Meta información con colores WW2 */
.latest-post-card .category-tag {
    color: var(--ww2-color-primary, #b3413e) !important;
    font-family: var(--ww2-font-sans, 'Oswald', sans-serif) !important;
    font-weight: 500 !important;
    text-transform: uppercase !important;
    letter-spacing: 0.5px !important;
    background-color: rgba(179, 65, 62, 0.1) !important;
    padding: 2px 6px !important;
    border-radius: 3px !important;
    border: 1px solid rgba(179, 65, 62, 0.3) !important;
}

.latest-post-card .reading-time {
    color: #454545 !important;
    font-family: var(--ww2-font-serif, 'Source Serif Pro', serif) !important;
    font-weight: 400 !important;
    font-style: italic !important;
}

/* Título del post */
.latest-post-card .post-title {
    color: var(--ww2-color-primary, #b3413e) !important;
    font-family: var(--ww2-font-sans, 'Oswald', sans-serif) !important;
    font-weight: 700 !important;
    text-transform: uppercase !important;
    letter-spacing: 0.5px !important;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
}

/* Descripción del post */
.latest-post-card .post-description {
    color: #454545 !important;
    font-family: var(--ww2-font-serif, 'Source Serif Pro', serif) !important;
    font-weight: 400 !important;
    line-height: 1.5 !important;
}

/* Read more link */
.latest-post-card .read-more-link {
    color: var(--ww2-color-primary, #b3413e) !important;
    font-family: var(--ww2-font-sans, 'Oswald', sans-serif) !important;
    font-weight: 600 !important;
    text-transform: uppercase !important;
    letter-spacing: 0.5px !important;
}

/* Efectos hover para los textos */
.latest-post-card:hover .post-title {
    color: #454545 !important;
}

.latest-post-card:hover .post-description {
    color: var(--ww2-color-primary, #b3413e) !important;
}

.latest-post-card:hover .read-more-link {
    color: #454545 !important;
}

.latest-post-card:hover .category-tag {
    color: #454545 !important;
    background-color: rgba(69, 69, 69, 0.1) !important;
    border-color: rgba(69, 69, 69, 0.3) !important;
}

.latest-post-card:hover .reading-time {
    color: var(--ww2-color-primary, #b3413e) !important;
}

/* Responsive ajustes */
@media (max-width: 768px) {
    .latest-post-card {
        border-width: 2px; /* Borde más delgado en móviles */
        max-width: 100%; /* Aprovechar ancho completo en móviles */
        margin: 0 auto; /* Centrar en móviles */
    }
    
    .latest-post-card:hover {
        transform: translateY(-2px) rotate(0.5deg);
    }
    
    /* Título más pequeño en móviles */
    .latest-bite-title {
        font-size: 1.125rem !important; /* text-lg equivalente */
    }
    
    /* Ajustar espaciado en móviles */
    .latest-post-card .post-content {
        padding: 12px !important;
    }
}

/* Dark mode adjustments */
@media (prefers-color-scheme: dark) {
    .latest-post-card {
        background-blend-mode: multiply;
        border-color: #d15851; /* Borde rojo más claro para dark mode */
    }
    
    .latest-post-card:hover {
        border-color: #b3413e; /* Rojo original en hover para dark mode */
    }
    
    .vintage-overlay {
        background: linear-gradient(
            135deg,
            rgba(245, 245, 220, 0.2) 0%,
            rgba(250, 235, 215, 0.15) 25%,
            rgba(240, 230, 200, 0.2) 50%,
            rgba(245, 240, 220, 0.15) 75%,
            rgba(248, 243, 223, 0.2) 100%
        );
    }
}
</style>
